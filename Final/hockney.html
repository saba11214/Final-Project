<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    <title>David Hockney</title>
    <link rel="icon" type="image/ico" href="images/favicon-pool.ico">

    <style>
      .background {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        max-height: 100%;
        margin: auto;
        overflow: auto;
      }
      #container {
        width: 452px;
        height: 100%;
        margin: auto;
      }

      canvas {
        /* border: 1px solid black; */
        position: absolute;
        top: 50%;
        margin-top: -190px;
        margin-left: -105px;
      }
    </style>
  </head>

  <body id="background">
    <img class="background" src="images/Gallery1.jpg">
    <div id="container">
      <canvas id="drawing" width="660" height="288">
        <p>This browser doesnâ€™t support the HTML canvas</p>
      </canvas>
    </div>

    <script>
      const canvas = document.getElementById('drawing');
      const context = canvas.getContext('2d');

      var referenceWidth = 660;
      var referenceHeight = 288;

      var x = Math.floor(Math.random()*255);
      var y = Math.floor(Math.random()*255);
      var z = Math.floor(Math.random()*255);
      var fps = 30;

      function setup() {
        canvas.style.width = referenceWidth + 'px';
        canvas.style.height = referenceHeight + 'px';

        var scale = window.devicePixelRatio;
        canvas.width = referenceWidth * scale;
        canvas.height = referenceHeight * scale;

        context.scale(scale, scale);

        draw();}

      function draw() {

          var img = new Image();
          img.src = 'images/hockney.jpg';

          img.addEventListener('load', function() {
            setTimeout (function () {
            context.drawImage(img, 0, 0, referenceWidth, referenceHeight);

            context.save();
            context.globalCompositeOperation = 'exclusion';
            rectangle();
            context.restore();
            requestAnimationFrame(draw);
          }, 11000 / fps);
          });
          x = Math.floor(Math.random()*255);
          y = Math.floor(Math.random()*255);
          z = Math.floor(Math.random()*255);
      }

      function rectangle() {
        var x = Math.floor(Math.random()*255);
        var y = Math.floor(Math.random()*255);
        var z = Math.floor(Math.random()*255);

        context.beginPath();
        context.moveTo(0, 148);
        context.lineTo(435, 148);
        context.lineTo(495, 288);
        context.lineTo(0, 288);
        context.closePath();
        context.fillStyle = 'rgb(' + z + ',' +  x + ', ' + y + ' , 0.5)';
        context.fill();
      }

      window.addEventListener('load', setup);
    </script>
  </body>
</html>
